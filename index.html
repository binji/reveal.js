<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>reveal.js - The HTML Presentation Framework</title>

    <meta name="description" content="A framework for easily creating beautiful presentations using HTML">
    <meta name="author" content="Hakim El Hattab">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/black.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <style>
      iframe {
        border: 3px solid #666;
        margin-bottom: 5px;
        max-width: 100%;
      }

      ul.nobullet {
        list-style: none;
      }

      .yellowgreen {
        color: yellowgreen;
      }

      .my-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.7);
      }
    </style>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section>
          <h1>Desktop Software on the Web</h1>
          <p>Bringing FOSS Desktop Software to the Browser</p>
          <p>
            <div><small>Feb 1, 2015</small></div>
            <div><small>Ben Smith <a href="http://twitter.com/binjimint">@binjimint</a></small></div>
          </p>
        </section>
        <section>
          <h2>Goal</h2>
          <p>
            I want to develop code in the browser.
          </p>
          <h2 class="fragment">Why?</h2>
          <ul>
            <li class="fragment">No need to install anything</li>
            <li class="fragment">One of the best ways to seamlessly share
              content </li>
            <li class="fragment">Cross-platform and cross-architecture </li>
          </ul>
        </section>
        <section>
          <h2>What I need</h2>
          <p>I primarily develop in a console window, so I don't need
            anything too fancy</p>
          <ul class="fragment">
            <li>bash</li>
            <li>gcc</li>
            <li>vim</li>
            <li>git</li>
            <li>make</li>
            <li class="fragment">cat? <img style="position: absolute; right: 0; bottom: 0;" src="pic/ascii-cat.jpg" style="width: 300px"></li>
          </ul>
        </section>
        <section>
          <h2>Q: Why is this hard?</h2>
          <h3 class="fragment">A: Web platform security</h3>
          <ul>
            <li class="fragment">You can't run executables</li>
            <li class="fragment">You can't access the filesystem directly</li>
            <li class="fragment">Standard desktop APIs are not available</li>
          </ul>
        </section>
        <section>
          <h2>Native Client</h2>
          <p>
            It is safe to run untrusted executables if we can
            <em>validate</em> and <em>sandbox</em> them.
          </p>
          <p class="fragment">
            Native Client (NaCl) provides a validator that looks for illegal
            instructions, as well as a sandbox that prevents illegal data
            accesses and illegal I/O operations.
          </p>
          <p class="fragment">
            Executables that fail validation <em>will not be run</em>.
          </p>
          <div class="fragment my-overlay">
            <img style="height: 100%;" src="pic/shall-not-pass.jpg">
          </div>
        </section>
        <section>
          <h2>Pepper</h2>
          <p>
            Pepper is the API that allows a Native Client application to
            communicate with the browser.
          </p>
          <p class="fragment" data-fragment-index="1">
            Pepper is a C/C++ API, and it aims to provide the same
            functionality as JavaScript.
          </p>
          <ul class="fragment" data-fragment-index="2">
            <li>XmlHttpRequest <span class="fragment yellowgreen" data-fragment-index="3">=&gt; pp::URLLoader</span></li>
            <li>Canvas <span class="fragment yellowgreen" data-fragment-index="3">=&gt; pp::Graphics2D</span></li>
            <li>WebGL <span class="fragment yellowgreen" data-fragment-index="3">=&gt; pp::Graphics3D</span></li>
            <li>WebAudio <span class="fragment yellowgreen" data-fragment-index="3">=&gt; pp::Audio</span></li>
            <li>Sandboxed Filesystem <span class="fragment yellowgreen" data-fragment-index="3">=&gt; pp::FileSystem</span></li>
            <li>...</li>
          </ul>
          <div class="fragment my-overlay" data-fragment-index="4">
            <img src="pic/pepper-cat.jpg">
          </div>
        </section>
        <section>
          <h2>nacl_io</h2>
          <p>
            nacl_io is a Native Client library that provides a POSIX-like
            compatibility layer on top of Pepper.
          </p>
          <p class="fragment">
            This primarily provides a virtual filesystem, with various
            filesystem types:
            <ul class="fragment">
              <li>In-memory</li>
              <li>Sandboxed persistent storage</li>
              <li>Read-only HTTP filesystem</li>
              <li>FUSE</li>
            </ul>
          </p>
        </section>
        <section>
          <h2>nacl-spawn</h2>
          <p>
            nacl-spawn is a Native Client library that provides an emulation of
            POSIX-like processes.
          </p>
          <p class="fragment">
            Processes are emulated by using JavaScript as the "kernel" and
            spawning an additional Native Client module for every new process.
            Interprocess communcation is piped through JavaScript.
          </p>
          <div class="fragment my-overlay">
            <img src="pic/cat-corn.gif" style="height: 100%;">
          </div>
        </section>
        <section>
          <h2>Demo</h2>
          <iframe id="demo" class="stretch" data-src="devenv/bash.html"
            frameborder="0" marginwidth="0" marginheight="0" scrolling="no"
            style="border:3px solid #666; margin-bottom:5px; max-width: 100%;">
          </iframe>
        </section>
        <section>
          <h2>How does this all work?</h2>
        </section>
        <section>
          <h2>Hterm</h2>
          <p>
            hterm is a JavaScript based terminal emulator that can be embeded
            in web applications.
          </p>
          <p>
            It was originally written to provide a command line environment for
            Chrome OS.
          </p>
          <div class="fragment my-overlay">
            <img src="pic/hterm.png" style="position: absolute; top: 0; left: 30%; height: 100%;">
            <img class="fragment" src="pic/hterm-cat.png" style="position: absolute; top: 0; left: 30%; height: 100%;">
          </div>
        </section>
        <section>
          <h2>Terminal -> NaCl</h2>
          <ol>
            <li class="fragment">Type characters into an invisible
              &lt;input&gt; element</li>
            <li class="fragment">These characters are sent asynchronously to
              the NaCl module</li>
            <li class="fragment">In the NaCl process, the characters are
              buffered</li>
            <li class="fragment">When the NaCl module reads from stdin, it gets
              the buffered data</li>
          </ol>
        </section>
        <section>
          <h2>NaCl -> Terminal</h2>
          <ol>
            <li class="fragment">The NaCl process writes to stdout</li>
            <li class="fragment">Buffering happens via standard libc buffering
              (e.g. setbuf)</li>
            <li class="fragment">When stdout is flushed, the data is sent to
              JavaScript</li>
            <li class="fragment">A JavaScript callback responds to messages
              from NaCl, and displays the output in the terminal</li>
          </ol>
        </section>
        <section>
          <p>
            A Native Client module is loaded with an &lt;object&gt; or
            &lt;embed&gt; tag. Environment variables and arguments are passed
            via attributes.
          </p>
          <pre><code data-trim>
&lt;object width="0" height="0" data="bash.nmf"
        type="application/x-nacl"&gt;
  &lt;param name="NACL_PID" value="2"&gt;
  &lt;param name="NACL_PPID" value="1"&gt;
  &lt;param name="PS_TTY_COLS" value="66"&gt;
  &lt;param name="PS_TTY_ROWS" value="18"&gt;
  &lt;param name="TERM" value="xterm-256color"&gt;
  &lt;param name="PWD" value="/"&gt;
  &lt;param name="arg0" value="bash.nmf"&gt;
  &lt;param name="arg1" value="--init-file"&gt;
  &lt;param name="arg2" value="/mnt/http/bashrc"&gt;
  ...
&lt;/object&gt;
          </code></pre>
        </section>
        <section>
          <p>
            With just this, we have an environment where you can run simple
            bash builtins:
          </p>
          <iframe id="bash" class="stretch" data-src="devenv/bash.html"
            frameborder="0" marginwidth="0" marginheight="0" scrolling="no"
            style="border:3px solid #666; margin-bottom:5px; max-width: 100%;">
          </iframe>
        </section>
        <section>
          <p>
            To do anything more interesting, we need access to the
            filesystem.
          </p>
          <p class="fragment" data-fragment-index="1">
            Each "process" has its own virtual filesystem that has been
            identically initialized:
            <ul class="fragment nobullet" data-fragment-index="2">
              <li>/ <span class="fragment yellowgreen" data-fragment-index="3">=&gt; In-memory</span></li>
              <li>/bin</li>
              <li>/etc</li>
              <li>/home/user <span class="fragment yellowgreen" data-fragment-index="3">=&gt; Persistent</span></li>
              <li>/mnt/http <span class="fragment yellowgreen" data-fragment-index="3">=&gt; HTTP</span></li>
              <li>/mnt/html5 <span class="fragment yellowgreen" data-fragment-index="3">=&gt; Persistent</span></li>
              <li>/tmp <span class="fragment yellowgreen" data-fragment-index="3">=&gt; Temporary</span></li>
            </ul>
          </p>
          <div class="fragment overlay">
            <img src="pic/cat-folder.jpg" style="height: 100%">
          </div>
        </section>
        <section>
          <h2>ls, for example</h2>
          <ol>
            <li class="fragment">Launch new NaCl process</li>
            <li class="fragment">Pass args and environment to NaCl</li>
            <li class="fragment">Mount all virtual filesystem</li>
            <li class="fragment">Set current directory based on PWD environment
              variable</li>
            <li class="fragment">Run ls main()</li>
            <li class="fragment">Read directory entries (using getdents()) from
              virtual filesystem, write to stdout</li>
            <li class="fragment">Send stdout to JavaScript</li>
            <li class="fragment">Modify DOM elements to display terminal
              output</li>
          </ol>
        </section>
        <section>
          <h2>Spawning Processes</h2>
          <p>
            We patch programs that use "fork" or "exec" to use "vfork" or
            "spawnve" instead. These functions send a message to JavaScript.
            That creates a new &lt;object&gt; element pointing to this
            executable and using the given arguments.
          </p>
          <div class="fragment overlay">
            <img src="pic/cat-fork.jpg" style="height: 100%">
          </div>
        </section>
        <section>
          <h2>make, for example</h2>
          <ol>
            <li class="fragment">Make wants to spawn a new process</li>
            <li class="fragment">Calls vfork(), this is emulated by calling
              setjmp()</li>
            <li class="fragment">Execution continues, setting up file
              descriptors for the child process</li>
            <li class="fragment">execvp() is called, which:</li>
            <ol>
              <li class="fragment">Clones all file descriptors</li>
              <li class="fragment">Initializes a spawn message to send to
                JavaScript with the child environment, file descriptors, cwd,
                and args</li>
              <li class="fragment">Calls longjmp to resume parent process
                execution</li>
            </ol>
          </ol>
        </section>
        <section>
          <h2>Finally...</h2>
          <iframe id="nyancat" class="stretch" data-src="devenv/bash.html"
            frameborder="0" marginwidth="0" marginheight="0" scrolling="no"
            style="border:3px solid #666; margin-bottom:5px; max-width: 100%;">
          </iframe>
        </section>
        <section>
          <h2>Thanks!</h2>
          <div><small>Native Client: <a href="http://developer.chrome.com/native-client">http://developer.chrome.com/native-client</a></small></div>
          <div><small>Ben Smith <a href="http://twitter.com/binjimint">@binjimint</a></small></div>
        </section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: false,
        progress: true,
        history: false,
        center: true,

        transition: 'slide', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true }
        ]
      });

      window.onbeforeunload = function() {
        return 'Whoops, you accidentally hit Ctrl-W. Don\'t leave!';
      };

    </script>

  </body>
</html>
